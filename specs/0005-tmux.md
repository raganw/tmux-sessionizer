# Specification 5: Tmux Session Management

> Ingest the information from this file, implement the Low-Level Tasks, and generate the code that will satisfy the High and Mid-Level Objectives.

## High-Level Objective

- Implement tmux session management functionality

## Mid-Level Objective

- Generate valid tmux session names from directory paths
- Check if tmux is running and if specific sessions exist
- Create new tmux sessions or switch to existing ones
- Implement the same session behavior as the bash script

## Implementation Notes

- Use proper error handling for tmux commands
- Sanitize session names similarly to the bash script
- Handle the different cases: no tmux running, tmux running but session doesn't exist, session exists
- Prefer using the tmux_interface crate for tmux operations
- Follow the same session naming convention as the bash script

## Context

### Beginning context

- `Cargo.toml`
- `src/main.rs`
- `src/config.rs`
- `src/scanner.rs`
- `src/git.rs`
- `src/finder.rs`

### Ending context

- `src/session.rs` (new)
- `src/main.rs` (updated)
- `Cargo.toml` (updated with tmux_interface dependency)

## Low-Level Tasks

> Ordered from start to finish

1. Add tmux_interface dependency

```aider
UPDATE Cargo.toml to add the tmux_interface dependency.
Add tmux_interface with an appropriate version number.
```

2. Create session manager module

```aider
CREATE src/session.rs module for tmux session management.
Define a SessionManager struct that will handle tmux operations.
Implement methods to:
- Generate sanitized session names from paths
- Special handling for worktree naming format: [parent] worktree
- Check if a tmux server is running
- Check if a specific session exists
```

3. Implement session creation and switching

```aider
UPDATE src/session.rs to implement session management.
Add methods to:
- Create a new tmux session with a given name and directory
- Switch to an existing session
- Handle the case where tmux is not running
- Handle appropriate error conditions
```

4. Implement Selection struct and logic

```aider
UPDATE src/session.rs to define a Selection struct.
The Selection should include:
- path: PathBuf
- display_name: String
- session_name: String
Add methods to create a Selection from a DirectoryEntry.
```

5. Integrate session manager with main

```aider
UPDATE src/main.rs to use the SessionManager.
Update the main function to:
- Create a Selection from the chosen DirectoryEntry
- Initialize the SessionManager
- Create or switch to the appropriate tmux session
- Handle errors properly
```
